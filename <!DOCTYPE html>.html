<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rozumné Investovanie – Portfolio Tracker</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="icon" href="https://i.imgur.com/DN2J9yG.png">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    :root{
      --bg:#0b0e12; --panel:#11151c; --muted:#7f8ea3; --text:#e8eef6; --brand:#f0c531; --brand-2:#ffb84d;
      --danger:#e05656; --warning:#f59e0b; --success:#3ecf8e; --shadow:0 10px 30px rgba(0,0,0,.35); --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(60rem 60rem at -10% -20%, #101522 0%, #0b0e12 40%, #0b0e12 100%);
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,sans-serif;color:var(--text);line-height:1.45;letter-spacing:.2px}
    header{position:sticky;top:0;z-index:20;backdrop-filter:saturate(120%) blur(8px);
      background:linear-gradient(180deg, rgba(16,19,25,.9) 0%, rgba(16,19,25,.65) 100%);border-bottom:1px solid rgba(255,255,255,.06)}
    .container{max-width:1200px;margin-inline:auto;padding:18px 22px}
    .brand{display:flex;align-items:center;gap:18px}
    .brand img{width:72px;height:72px;border-radius:16px;box-shadow:var(--shadow)}
    .brand h1{margin:0;font-size:1.6rem;font-weight:800;letter-spacing:.5px}
    .brand small{display:block;color:var(--muted);font-weight:500}

    main{padding:26px 22px 80px}
    .grid{display:grid;gap:22px}
    @media(min-width:980px){.grid{grid-template-columns:1.15fr .85fr}}
    .card{background:linear-gradient(180deg,#121722 0%,#0f141d 100%);border:1px solid rgba(255,255,255,.06);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px}
    .card h2{margin:0 0 14px;font-size:1.05rem;font-weight:800}
    label{display:block;font-weight:600;font-size:.85rem;margin:10px 0 8px}
    input,select,button,textarea{font:inherit;color:var(--text)}
    .row{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
    .col-6{grid-column:span 6}.col-4{grid-column:span 4}.col-3{grid-column:span 3}.col-12{grid-column:span 12}
    @media(max-width:720px){.col-6,.col-4,.col-3{grid-column:span 12}}

    .input{display:flex;align-items:center;gap:10px;background:#0c1119;border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:12px 14px;transition:.2s border-color}
    .input:focus-within{border-color:rgba(240,197,49,.65)}
    .input input{width:100%;background:transparent;border:0;outline:0}
    .suffix{color:var(--muted);font-weight:600;font-size:.9rem}

    .btn{background:linear-gradient(180deg,var(--brand),var(--brand-2));color:#1a1300;font-weight:800;border:0;border-radius:14px;padding:12px 16px;cursor:pointer;box-shadow:0 6px 18px rgba(240,197,49,.25);transition:transform .06s ease, box-shadow .2s ease}
    .btn:hover{transform:translateY(-1px);box-shadow:0 10px 28px rgba(240,197,49,.35)}
    .btn.secondary{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.12)}

    .kpitable{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:8px}
    .kpi{background:linear-gradient(180deg,#0e141e,#0c1219);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:14px 16px}
    .kpi small{color:var(--muted);font-weight:600}
    .kpi strong{display:block;font-size:1.35rem;margin-top:8px}

    .scoreBadge{display:flex;align-items:center;justify-content:center;width:140px;height:140px;border-radius:22px;font-weight:900;font-size:56px;letter-spacing:1px;box-shadow:var(--shadow);border:1px solid rgba(255,255,255,.08)}

    .table{width:100%;border-collapse:separate;border-spacing:0 8px;margin-top:10px}
    .table th{font-size:.78rem;color:var(--muted);font-weight:700;text-align:left;padding:6px 10px}
    .table td{background:#0d131c;border:1px solid rgba(255,255,255,.06);border-left:0;border-right:0;padding:10px}

    .pill{display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(255,255,255,.08);background:#0c1119;padding:7px 10px;border-radius:30px;font-size:.8rem;color:var(--muted)}
    nav.card .btn.secondary{border-color:rgba(255,255,255,.10)}

    .status{position:fixed;bottom:10px;right:10px;background:#0c1119;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:6px 10px;color:var(--muted);font-size:.8rem}

    @media print{header,.no-print,nav.card,.status{display:none!important}body{background:#fff;color:#000}.card{box-shadow:none;border:1px solid #ddd}.kpi strong{color:#000}}
  </style>
</head>
<body>
  <header>
    <div class="container" style="display:flex;align-items:center;justify-content:space-between;gap:16px">
      <div class="brand">
        <img src="https://i.imgur.com/DN2J9yG.png" alt="Rozumné Investovanie" onerror="this.src='';this.style.background='linear-gradient(135deg,#f0c531,#ffb84d)';"/>
        <div>
          <h1>ROZUMNÉ INVESTOVANIE • Portfolio Tracker</h1>
          <small>Prehľad, projekcie, dáta. Čistý dizajn, čisté výstupy.</small>
        </div>
      </div>
      <div class="no-print" style="display:flex;gap:10px;align-items:center">
        <a class="btn secondary" href="#kontakt" id="openContact">Kontakt</a>
        <button class="btn" id="exportPdf">Exportovať PDF</button>
      </div>
    </div>
  </header>

  <main class="container" style="padding-top:28px">
    <nav class="card no-print" style="padding:10px;margin-bottom:18px">
      <div style="display:flex;flex-wrap:wrap;gap:8px">
        <button class="btn secondary" data-tab="tracker">Tracker</button>
        <button class="btn secondary" data-tab="market">Trhy (akcie/krypto/zlato)</button>
        <button class="btn secondary" data-tab="etf">ETF hodnotenie</button>
        <button class="btn secondary" data-tab="faq">FAQ</button>
        <button class="btn secondary" data-tab="contact">Kontakt</button>
      </div>
    </nav>

    <section id="tab-tracker" class="grid">
      <section class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:6px">
          <h2>Vstupy &amp; nastavenia</h2>
          <span class="pill"><span style="width:10px;height:10px;border-radius:50%;background:var(--brand)"></span> Brand: Rozumné Investovanie</span>
        </div>
        <div class="row">
          <div class="col-6"><label>Mesačný vklad</label><div class="input"><input id="monthly" type="number" min="0" step="10" value="200"><span class="suffix">€</span></div></div>
          <div class="col-6"><label>Počiatočná investícia</label><div class="input"><input id="initial" type="number" min="0" step="50" value="1000"><span class="suffix">€</span></div></div>
          <div class="col-6"><label>Priemerný ročný výnos (p.a.)</label><div class="input"><input id="rate" type="number" min="0" max="20" step="0.1" value="7"><span class="suffix">%</span></div></div>
          <div class="col-6"><label>Horizont</label><div class="input"><input id="years" type="number" min="1" max="50" step="1" value="10"><span class="suffix">rokov</span></div></div>
          <div class="col-12" style="display:flex;gap:10px;flex-wrap:wrap;margin-top:6px">
            <button class="btn" id="calcBtn">Spočítať môj rast</button>
            <button class="btn secondary" id="resetBtn">Reset</button>
            <button class="btn secondary" id="scenarioBtn" title="Ulož konfiguráciu vpravo a porovnávaj">Nápoveda scenáre</button>
          </div>
        </div>
        <div class="kpitable" style="margin-top:10px">
          <div class="kpi"><small>Celkovo vložené</small><strong id="kpiInvested">–</strong></div>
          <div class="kpi"><small>Odhadovaná hodnota</small><strong id="kpiFuture">–</strong></div>
          <div class="kpi"><small>Zisk / Zhodnotenie</small><strong id="kpiGain">–</strong></div>
        </div>
        <div style="margin-top:18px;height:220px"><canvas id="growthChart"></canvas></div>
        <div style="margin-top:18px">
          <h2>Rozpis po rokoch</h2>
          <table class="table" id="breakdownTable">
            <thead><tr><th>Rok</th><th>Vložené celkom</th><th>Hodnota portfólia</th><th>Zisk</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="no-print" style="margin-top:10px;color:var(--muted)">Tip: čísla sú orientačné, nezohľadňujú dane ani poplatky.</div>
      </section>
      <aside class="card">
        <h2>Scenáre & porovnanie</h2>
        <p class="muted" style="margin-top:-4px">Ulož si viac nastavení a porovnaj ich vedľa seba.</p>
        <div style="display:flex;gap:10px;margin:10px 0 14px"><button class="btn" id="saveScenario">Uložiť aktuálny scenár</button><button class="btn secondary" id="clearScenarios">Vymazať scenáre</button></div>
        <div style="height:280px"><canvas id="scenarioChart"></canvas></div>
      </aside>
    </section>

    <section id="tab-market" class="card" style="display:none">
      <h2>Trhový prehľad – akcie • krypto • zlato</h2>
      <p class="muted">Živé dáta z verejných API (bez kľúča). Pri CORS blokácii zobrazíme poslednú hodnotu.</p>
      <div class="row" style="margin-top:10px">
        <div class="col-4"><label>Akcia (ticker, napr. AAPL)</label><div class="input"><input id="stockTicker" placeholder="AAPL"></div></div>
        <div class="col-4"><label>Kryptomena</label><div class="input"><input id="cryptoId" placeholder="bitcoin"></div></div>
        <div class="col-4"><label>Zlato (XAU)</label><div class="input"><input value="XAU" disabled></div></div>
        <div class="col-12" style="margin-top:6px"><button class="btn" id="refreshMarket">Aktualizovať trhy</button></div>
      </div>
      <div class="kpitable">
        <div class="kpi"><small>Akcia</small><strong id="kpiStock">–</strong></div>
        <div class="kpi"><small>Krypto</small><strong id="kpiCrypto">–</strong></div>
        <div class="kpi"><small>Zlato</small><strong id="kpiGold">–</strong></div>
      </div>
      <div style="margin-top:18px;height:220px"><canvas id="marketChart"></canvas></div>
    </section>

    <section id="tab-etf" class="card" style="display:none">
      <h2>ETF hodnotenie (1–10)</h2>
      <p class="muted">Zadaj Ticker alebo ISIN. Pri známych fondoch sa parametre predvyplnia. Skóre je heuristické (nie odporúčanie).</p>
      <div class="row">
        <div class="col-4"><label>Ticker alebo ISIN</label><div class="input"><input id="etfTicker" placeholder="napr. VWCE alebo IE00BK5BQT80"></div></div>
        <div class="col-4"><label>TER (%)</label><div class="input"><input id="etfTer" type="number" step="0.01" placeholder="0.22"></div></div>
        <div class="col-4"><label>Vek (roky)</label><div class="input"><input id="etfAge" type="number" step="1" placeholder="5"></div></div>
        <div class="col-4"><label>AUM (mld €)</label><div class="input"><input id="etfAum" type="number" step="0.1" placeholder="10"></div></div>
        <div class="col-4"><label>Volatilita (ročná %)</label><div class="input"><input id="etfVol" type="number" step="0.1" placeholder="15"></div></div>
        <div class="col-4"><label>Tracking error (%)</label><div class="input"><input id="etfTe" type="number" step="0.01" placeholder="0.20"></div></div>
        <div class="col-12" style="margin-top:6px"><button class="btn" id="scoreEtf">Vyhodnotiť ETF</button></div>
      </div>
      <div class="kpitable">
        <div class="kpi"><small>ETF</small><strong id="etfName">–</strong></div>
        <div class="kpi" style="display:flex;align-items:center;justify-content:center"><div id="etfScore" class="scoreBadge">–</div></div>
        <div class="kpi"><small>Verdikt</small><strong id="etfVerdict">–</strong></div>
      </div>
      <div class="muted" style="margin-top:12px">Váhy: TER 25 %, TE 20 %, AUM 15 %, Vek 15 %, Volatilita 15 %, Diverzifikácia (proxy AUM+vek) 10 %.</div>
    </section>

    <section id="tab-faq" class="card" style="display:none">
      <h2>FAQ – Často kladené otázky</h2>
      <details open><summary>Je výpočet v trackeri presný?</summary><p class="muted">Je to orientačný model DCA s mesačným úročením. Nezohľadňuje dane, poplatky brokera a náklady fondov (TER). Na konzultácii ich vieme doplniť.</p></details>
      <details><summary>Odkiaľ sú trhové dáta?</summary><p class="muted">Akcie: Stooq (bez kľúča, môže mať CORS). Krypto: CoinGecko. Zlato: Metals.live. Pri blokácii UI zobrazí poslednú hodnotu (fallback).</p></details>
      <details><summary>Čo znamená skóre ETF?</summary><p class="muted">Heuristické skóre 1–10 podľa nákladovosti, stability a kvality replikácie indexu. Nie je to investičné odporúčanie.</p></details>
      <details><summary>Môžem dostať PDF report?</summary><p class="muted">Áno – tlačidlom „Exportovať PDF“. Ak prehliadač blokuje knižnicu, použije sa kvalitný tlačový export (print-to-PDF).</p></details>
    </section>

    <section id="tab-contact" class="card" style="display:none">
      <h2 id="kontakt">Kontakt</h2>
      <div class="row">
        <div class="col-6"><div class="kpi"><small>E‑mail</small><strong><a href="mailto:igor.slysko@universal.sk">igor.slysko@universal.sk</a></strong></div></div>
        <div class="col-6"><div class="kpi"><small>Tel.</small><strong><a href="tel:+421907627938">+421 907 627 938</a></strong></div></div>
      </div>
      <form id="leadForm" class="card" style="margin-top:16px;padding:14px;background:#0a1016">
        <h2 style="margin-top:0">Pošli mi svoju otázku / dostávaj PDF reporty</h2>
        <label>E‑mail</label><div class="input"><input type="email" id="email" placeholder="napr. ja@domena.sk" required></div>
        <label>Správa (voliteľné)</label><div class="input"><input type="text" id="msg" placeholder="Čo chceš vyriešiť?"></div>
        <div style="display:flex;gap:10px;margin-top:10px"><button type="submit" class="btn">Odoslať</button></div>
        <small class="muted">Odoslaním súhlasíš so spracovaním e‑mailu na účely odpovede a zasielania tipov.</small>
      </form>
    </section>
  </main>

  <div class="status" id="status">Self‑test: prebieha…</div>

  <script>
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const safeOn = (el, ev, fn) => el && el.addEventListener(ev, fn);
    const fmt = n => Number(n||0).toLocaleString('sk-SK', {maximumFractionDigits:0});

    const tabs = {tracker:$('#tab-tracker'), market:$('#tab-market'), etf:$('#tab-etf'), faq:$('#tab-faq'), contact:$('#tab-contact')};
    function openTab(id){ if(!tabs[id]) return; Object.entries(tabs).forEach(([key,el])=>{ if(!el) return; el.style.display = key===id ? (id==='tracker'?'grid':'block') : 'none'; }); window.scrollTo({top:0,behavior:'smooth'}); }
    $$('[data-tab]').forEach(btn=>safeOn(btn,'click',()=>openTab(btn.getAttribute('data-tab'))));
    safeOn($('#openContact'),'click',evt=>{evt.preventDefault();openTab('contact'); setTimeout(()=>$('#kontakt')?.scrollIntoView({behavior:'smooth',block:'start'}),200);});

    function projection({monthly, initial, rate, years}){
      const r = (rate/100)/12; let value = initial; const rows=[]; let invested = initial; const labels=[]; const data=[];
      for(let y=1;y<=years;y++){ for(let m=1;m<=12;m++){ value *= (1+r); value += monthly; invested += monthly; } labels.push(String(y)); data.push(Math.round(value)); rows.push({year:y,invested:Math.round(invested),value:Math.round(value),gain:Math.round(value-invested)}); }
      return {labels,data,rows,invested:Math.round(invested),value:Math.round(value)};
    }

    const monthlyEl=$('#monthly'), initialEl=$('#initial'), rateEl=$('#rate'), yearsEl=$('#years');
    const kpiInvested=$('#kpiInvested'), kpiFuture=$('#kpiFuture'), kpiGain=$('#kpiGain');
    const breakdownBody=$('#breakdownTable tbody');
    let growthChart, scenarioChart;

    function render(){
      if(!monthlyEl) return;
      const cfg={monthly:Number(monthlyEl.value||0), initial:Number(initialEl.value||0), rate:Number(rateEl.value||0), years:Math.max(1, Number(yearsEl.value||1))};
      const p=projection(cfg);
      if(kpiInvested) kpiInvested.textContent = fmt(p.invested)+' €';
      if(kpiFuture) kpiFuture.textContent = fmt(p.value)+' €';
      if(kpiGain) kpiGain.textContent = fmt(p.value-p.invested)+' € ('+((p.value/p.invested-1)*100).toFixed(1)+' %)';
      if(breakdownBody) breakdownBody.innerHTML = p.rows.map(r=>`<tr><td>Rok ${r.year}</td><td>${fmt(r.invested)} €</td><td><strong>${fmt(r.value)} €</strong></td><td style="color:${r.gain>=0?'#3ecf8e':'#e05656'}">${fmt(r.gain)} €</td></tr>`).join('');
      const ctx=$('#growthChart');
      if(ctx){ if(growthChart) growthChart.destroy(); growthChart=new Chart(ctx,{type:'line',data:{labels:p.labels.map(l=>'Rok '+l),datasets:[{label:'Hodnota portfólia',data:p.data,tension:.25,pointRadius:0,borderWidth:3,borderColor:getComputedStyle(document.documentElement).getPropertyValue('--brand'),fill:true,backgroundColor:'rgba(240,197,49,.12)'}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{callbacks:{label:(c)=>fmt(c.parsed.y)+' €'}}},scales:{y:{grid:{color:'rgba(255,255,255,.08)'},ticks:{color:'#b8c3d6',callback:v=>fmt(v)+' €'}},x:{grid:{display:false},ticks:{color:'#95a2b6'}}}}); }
    }

    const scenarios=[];
    function renderScenarios(){
      const ctx=$('#scenarioChart'); if(!ctx) return; if(scenarioChart) scenarioChart.destroy();
      scenarioChart=new Chart(ctx,{type:'bar',data:{labels:scenarios.map(s=>s.name),datasets:[{label:'Vložené',data:scenarios.map(s=>s.invested),backgroundColor:'rgba(184,195,214,.35)'},{label:'Hodnota',data:scenarios.map(s=>s.value),backgroundColor:'rgba(240,197,49,.75)'}]},options:{plugins:{legend:{labels:{color:'#c9d3e3'}}},scales:{y:{ticks:{color:'#b8c3d6',callback:v=>fmt(v)+' €'},grid:{color:'rgba(255,255,255,.08)'}},x:{ticks:{color:'#95a2b6'}}}});
    }

    safeOn($('#calcBtn'),'click',render);
    safeOn($('#resetBtn'),'click',()=>{ if(!monthlyEl) return; monthlyEl.value=200; initialEl.value=1000; rateEl.value=7; yearsEl.value=10; render(); });
    safeOn($('#scenarioBtn'),'click',()=>alert('Použi panel vpravo – ulož aktuálny scenár a porovnaj ho s ďalším.'));
    safeOn($('#saveScenario'),'click',()=>{ if(!monthlyEl) return; const cfg={monthly:Number(monthlyEl.value||0),initial:Number(initialEl.value||0),rate:Number(rateEl.value||0),years:Number(yearsEl.value||0)}; const p=projection(cfg); const name=prompt('Názov scenára (napr. "Konzervatívny 4%")',`${cfg.monthly}€/m • ${cfg.rate}% • ${cfg.years}r`); if(!name) return; scenarios.push({name,invested:p.invested,value:p.value}); renderScenarios(); });
    safeOn($('#clearScenarios'),'click',()=>{ if(confirm('Vymazať všetky scenáre?')){ scenarios.length=0; renderScenarios(); }});

    const marketSeries={labels:[],stock:[],crypto:[],gold:[]}; let marketChart;
    async function fetchJSON(url){ try{ const r=await fetch(url,{cache:'no-store'}); if(!r.ok) throw new Error('status '+r.status); return await r.json(); }catch(e){ console.warn('Fetch failed',url,e); return null; } }
    async function loadMarkets(){
      const ticker=($('#stockTicker')?.value||'AAPL').toLowerCase();
      const crypto=($('#cryptoId')?.value||'bitcoin').toLowerCase();
      let stockPrice=null; const stooq=await fetchJSON(`https://stooq.com/q/l/?s=${ticker}.us&f=sd2t2ohlcv&h&e=json`);
      if(stooq && stooq.symbols && stooq.symbols[0] && stooq.symbols[0].close) stockPrice=Number(stooq.symbols[0].close); if(!stockPrice) stockPrice=marketSeries.stock.at(-1)||180;
      let cryptoPrice=null; const cg=await fetchJSON(`https://api.coingecko.com/api/v3/simple/price?ids=${crypto}&vs_currencies=eur`);
      if(cg && cg[crypto] && cg[crypto].eur) cryptoPrice=Number(cg[crypto].eur); if(!cryptoPrice) cryptoPrice=marketSeries.crypto.at(-1)||60000;
      let goldPrice=null; const gold=await fetchJSON('https://api.metals.live/v1/spot/gold');
      if(Array.isArray(gold) && gold[0] && gold[0].price) goldPrice=Number(gold[0].price); if(!goldPrice) goldPrice=marketSeries.gold.at(-1)||2300;
      const ts=new Date().toLocaleTimeString(); marketSeries.labels.push(ts); marketSeries.stock.push(stockPrice); marketSeries.crypto.push(cryptoPrice); marketSeries.gold.push(goldPrice);
      if($('#kpiStock')) $('#kpiStock').textContent = `${ticker.toUpperCase()} ${stockPrice.toLocaleString('sk-SK',{maximumFractionDigits:2})} $`;
      if($('#kpiCrypto')) $('#kpiCrypto').textContent = `${crypto} ${cryptoPrice.toLocaleString('sk-SK',{maximumFractionDigits:0})} €`;
      if($('#kpiGold')) $('#kpiGold').textContent = `XAU ${goldPrice.toLocaleString('sk-SK',{maximumFractionDigits:0})} $`;
      const ctx=$('#marketChart'); if(ctx){ if(marketChart) marketChart.destroy(); marketChart=new Chart(ctx,{type:'line',data:{labels:marketSeries.labels,datasets:[{label:'Akcia',data:marketSeries.stock,borderColor:getComputedStyle(document.documentElement).getPropertyValue('--brand'),backgroundColor:'rgba(240,197,49,.10)',tension:.3,pointRadius:0,borderWidth:2},{label:'Krypto',data:marketSeries.crypto,borderColor:'#7bcfff',backgroundColor:'rgba(123,207,255,.10)',tension:.3,pointRadius:0,borderWidth:2},{label:'Zlato',data:marketSeries.gold,borderColor:'#b8c3d6',backgroundColor:'rgba(184,195,214,.08)',tension:.3,pointRadius:0,borderWidth:2}]},options:{plugins:{legend:{labels:{color:'#c9d3e3'}}},scales:{y:{ticks:{color:'#b8c3d6'}},x:{ticks:{color:'#95a2b6'}}}}); }
    }
    safeOn($('#refreshMarket'),'click',loadMarkets);

    const ETF_DB=[
      {ticker:'VWCE', isin:'IE00BK5BQT80', ter:0.22, age:5, aum:14, vol:15, te:0.20},
      {ticker:'CSPX', isin:'IE00B5BMR087', ter:0.07, age:13, aum:35, vol:16, te:0.10},
      {ticker:'SXR8', isin:'IE00B5BMR087', ter:0.07, age:13, aum:9,  vol:16, te:0.12},
      {ticker:'VUSA', isin:'IE00B3XXRP09', ter:0.07, age:11, aum:7,  vol:16, te:0.12},
      {ticker:'EIMI', isin:'IE00BKM4GZ66', ter:0.18, age:9,  aum:6,  vol:19, te:0.25}
    ];
    function findETF(query){ const q=(query||'').trim().toUpperCase(); return ETF_DB.find(e=>e.ticker===q || e.isin===q) || null; }
    function scoreETF({ter,age,aum,vol,te}){
      const nTER=Math.max(0,Math.min(1,1-(ter/1.0))); const nAge=Math.max(0,Math.min(1,age/15)); const nAUM=Math.max(0,Math.min(1,aum/20)); const nVol=Math.max(0,Math.min(1,1-(vol/30))); const nTE=Math.max(0,Math.min(1,1-(te/1.0)));
      const w={ter:.25,te:.20,aum:.15,age:.15,vol:.15,div:.10}; const divProxy=(nAUM+nAge)/2; const score01=nTER*w.ter+nTE*w.te+nAUM*w.aum+nAge*w.age+nVol*w.vol+divProxy*w.div; return Math.round(score01*100)/10;
    }
    function scoreColor(score){ const t=Math.max(1,Math.min(10,score)); if(t<5) return '#e05656'; if(t<7.5) return '#f59e0b'; return '#3ecf8e'; }
    safeOn($('#scoreEtf'),'click',()=>{
      const q=$('#etfTicker').value; let params=findETF(q);
      if(!params){ params={ ter:Number($('#etfTer').value||0.2), age:Number($('#etfAge').value||5), aum:Number($('#etfAum').value||5), vol:Number($('#etfVol').value||15), te:Number($('#etfTe').value||0.2) }; }
      else { $('#etfTer').value=params.ter; $('#etfAge').value=params.age; $('#etfAum').value=params.aum; $('#etfVol').value=params.vol; $('#etfTe').value=params.te; }
      const s=scoreETF(params); const name=(findETF(q)?.ticker || q || 'ETF').toUpperCase();
      $('#etfName').textContent=name; const badge=$('#etfScore'); badge.textContent=s.toFixed(1); badge.style.color=scoreColor(s); $('#etfVerdict').textContent = s>=8?'Silné': s>=6?'OK':'Slabé';
    });

    safeOn($('#leadForm'),'submit',e=>{e.preventDefault();const email=$('#email').value.trim();alert(email?`Ďakujem! Ozvem sa na: ${email}`:'Zadaj prosím e‑mail.'); e.target.reset();});

    safeOn($('#exportPdf'),'click',()=>{
      const element=document.querySelector('main');
      if(window.html2pdf){ const opt={ filename:'rozumne-investovanie-portfolio-tracker.pdf', margin:0.5, image:{type:'jpeg',quality:0.98}, html2canvas:{scale:2,useCORS:true}, jsPDF:{unit:'in',format:'a4',orientation:'portrait'} }; window.html2pdf().set(opt).from(element).save(); }
      else { window.print(); alert('Export prebehol cez systémové PDF (print). Ak chceš priame PDF, povol načítanie html2pdf alebo použi iný prehliadač.'); }
    });

    render(); renderScenarios();

    (function selfTest(){
      let ok=true; const logs=[];
      try{ const s=scoreETF({ter:0.22,age:5,aum:14,vol:15,te:0.2}); if(!(s>0 && s<=10)) { ok=false; logs.push('scoreETF out of range'); } }catch(e){ ok=false; logs.push('scoreETF threw'); }
      try{ const p=projection({monthly:200,initial:1000,rate:7,years:10}); if(!(p.rows.length===10 && p.value>p.invested)) { ok=false; logs.push('projection mismatch'); } }catch(e){ ok=false; logs.push('projection threw'); }
      try{ const f=findETF('VWCE'); if(!f || f.isin!=='IE00BK5BQT80') { ok=false; logs.push('findETF failed'); } }catch(e){ ok=false; logs.push('findETF threw'); }
      const badge=$('#status'); if(badge) badge.textContent = ok? 'Self‑test: OK' : ('Self‑test: issues → '+logs.join(', '));
    })();
  </script>
</body>
</html>
